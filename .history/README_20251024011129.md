# 项目名

genshin-artifact-reroll

### 概要

精确的圣遗物重铸概率分析与卷积实现，提供离散分布卷积、按次数自卷积、按词条与整件圣遗物合并的精确算法，支持强制命中替换、分数化权重处理与 PMF 可视化，适用于小规模精确枚举与验证性分析.

## 功能 & 原理

1. 基于miao-plugin提供的权重算法来对角色圣遗物进行评分，若想自定义权重规则请修改ROLE_WEIGHTS_RAW
2. 内置了菲林斯及之前所有角色的基础属性以换算小词条, 若想更新新角色请修改BASE_STATS_RAW
3. 根据 输入角色名字 & 初始词条 & 当前词条, 从ROLE_WEIGHTS_RAW中读取对应的词条权重，若有小词条则通过白值折算为对应的大词条赋予权重
4. 输出强化后评分 > 当前评分 - 初始评分 + delta的概率, 绘制强化总分概率分布情况并提供交互式点击注释功能

### 原理说明

    将原神十个副词条改写为 7n:8n:9n:10n的形式进行整数化, 举例说明
    若需计算一件圣遗物五次强化后的双爆分＞50的概率, 
    {5.4: 6.2: 7.0: 7.8} = 7/9 * {7: 8: 9: 10}
    50/(7/9) = 64.28571428571429 
    问题转化为从7, 8, 9, 10中有放回抽取7次和 > 64的概率
    即从0, 1, 2, 3中抽七次和 > 15的概率
    又＞15的概率＝<21-15 = 6 的概率
    我们枚举和分别为0,1,2,3,4,5的总和/总样本数即为所求概率约为4.5%

    这个系统的运行机理就是类似这样, 不过是更加复杂化, 因为有权重的关系, 至多从16个数中抽取4/5次 > 当前评分 - 初始评分 + delta, 2.0版本新增了启示之尘的机制, 可以自定义选中词条和命中次数        



### 安装与运行
要求：Python 3.9+。

可选依赖：matplotlib、numpy。

### 安装（示例）：

创建虚拟环境并安装依赖：

bash
python -m venv .venv
.venv\Scripts\activate      # Windows
source .venv/bin/activate   # Linux / macOS
pip install matplotlib numpy 

### 运行示例脚本：

直接运行模块内的示例验证基本卷积与小规模联合分布输出：

python artifact_reroll_2.0.py

### 如何使用

1. 在BASE_STATS里找到对应角色, **调整ATK里的608为你的武器白值**
2. **修改main()里角色名**(角色全名(-xx), 不能是别名也不能有错别字), 初始词条, 当前词条
3. 修改精度delta, 可以计算提升多少词条的概率(一条6.6/3.3双爆是100*8.5,100是词条权重, 7/8/9/10对应四个档位)
4. 初始4 initial_substat_count=4, 初始3 initial_substat_count=3
5  填写约束(初始词条内), 如果你选定命中暴击爆伤 就填("暴击","暴伤")
6. 填写约束命中数2/3/4, 如果你想要计算选中词条至少命中2次的提升概率, 就填2
7. 运行代码, 会在gui生成图表, 也可修改参数以文件形式输出到同一目录

### Q&A 

1. 初始词条怎么看?
微信小程序提瓦特工具坊, 把你要看的圣遗物挂在展柜然后更新就行, 第一个数据就是初始值 or
enka.network, 打开显示圣遗物副词条强化状况, 下面的第一条横线下带几个点就是第几档强化

2. 我为什么要做这个?

包里一大堆圣遗物, 想知道哪些圣遗物重roll提升概率高,  没人写过, 所以就自己写了

3. 如何更新新角色 & 自定义权重?

在BASE_STATS_RAW和ROLE_WEIGHTS_RAW加入新角色数据即可

https://github.com/yoimiya-kokomi/miao-plugin/blob/c174945eeccba9ffa98ba9cf35e076d02c76e9bc/resources/meta-gs/character/
这是角色基础数据, 打开这个网页找到新角色的名字打开dase.json, 就能看到三维数据了, 如果这个文件夹中还有artis.json, 那么说明这个角色有多种权重

https://github.com/yoimiya-kokomi/miao-plugin/blob/c174945eeccba9ffa98ba9cf35e076d02c76e9bc/resources/meta-gs/artifact/artis-mark.js
这是miao-plugin的全角色圣遗物副词条权重, 拉到最下面找到新角色按照相同格式添加即可

### 许可证：建议 MIT 或 Apache-2.0。

### References

代码与实现细节（输入示例、基础数据字典、完整实现与注释）来源于当前工程 paste.